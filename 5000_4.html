<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biology Insects Flashcards (Enhanced Audio)</title>
    <style>
        :root {
            --primary-color: #e67e22;
            --secondary-color: #fcefe6;
            --text-color: #333;
            --bg-color: #f0f2f5;
            --card-width: 320px;
            --card-height: 480px;
        }

        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-color);
            overflow: hidden; /* Prevent body scroll during card interaction */
        }

        h1 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #555;
        }

        .progress-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .progress-text {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .card-container {
            width: var(--card-width);
            height: var(--card-height);
            perspective: 1000px;
            cursor: pointer;
            margin-bottom: 20px;
            position: relative;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            background-color: white;
            border: 2px solid #fff;
        }

        .card-front {
            z-index: 2;
        }

        .word-number {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 0.8rem;
            color: #999;
            font-weight: bold;
        }

        .word-main {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
            line-height: 1.2;
        }

        .word-phonetic {
            font-size: 1.1rem;
            color: #7f8c8d;
            font-family: "Lucida Sans Unicode", "Arial Unicode MS", sans-serif;
            margin-bottom: 30px;
        }

        .audio-btn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px rgba(230, 126, 34, 0.2);
        }

        .audio-btn:hover {
            transform: scale(1.1);
            background-color: #ffe0d0;
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .tap-hint {
            position: absolute;
            bottom: 20px;
            font-size: 0.8rem;
            color: #ccc;
        }

        .card-back {
            transform: rotateY(180deg);
            background-color: #fafafa;
            border: 2px solid var(--secondary-color);
            justify-content: flex-start;
            padding-top: 40px;
        }

        .word-translation {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            width: 100%;
        }

        .word-meaning-container {
            width: 100%;
            overflow-y: auto;
            text-align: left;
            padding-right: 5px;
            flex-grow: 1;
        }

        .word-meaning {
            font-size: 1rem;
            line-height: 1.7;
            color: #555;
        }

        .tag-ref {
            display: inline-block;
            background: #eee;
            color: #666;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.1s, opacity 0.2s;
            width: 140px;
        }

        .btn:active {
            transform: translateY(2px);
        }

        .btn-unknown {
            background-color: #ffffff;
            color: #7f8c8d;
            border: 2px solid #bdc3c7;
        }

        .btn-known {
            background-color: var(--primary-color);
            color: white;
            border: 2px solid var(--primary-color);
        }

        .completion-screen {
            display: none;
            text-align: center;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 100;
        }

        .completion-message {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        @media (max-width: 400px) {
            :root {
                --card-width: 90vw;
                --card-height: 60vh;
            }
            .btn {
                width: 40vw;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <h1>Biology 4: Insects</h1>

    <div class="progress-container">
        <span class="progress-text" id="progressText">Loading...</span>
    </div>

    <div class="card-container" id="cardContainer">
        <div class="card" id="card">
            <!-- Front -->
            <div class="card-face card-front">
                <div class="word-number" id="wordNumber">01</div>
                <div class="word-main" id="wordMain">complete metamorphosis</div>
                <div class="word-phonetic" id="wordPhonetic">[kÉ™mËˆpliËt mÉ›tÉ™ËˆmÉ”ËrfÉ™sÉªs]</div>
                <button class="audio-btn" id="audioBtn" title="ç™ºéŸ³ã‚’èã">ğŸ”Š</button>
                <div class="tap-hint">Tap card to flip</div>
            </div>
            <!-- Back -->
            <div class="card-face card-back">
                <div class="word-translation" id="wordTranslation">å®Œå…¨å¤‰æ…‹</div>
                <div class="word-meaning-container">
                    <div class="word-meaning" id="wordMeaning">
                        æ˜†è™«ã®æˆé•·ã®éç¨‹ã§ã€åµâ†’å¹¼è™«â†’ã•ãªãã®3ã¤ã®æ®µéšã‚’çµŒã¦æˆè™«ã«å¤‰åŒ–ã™ã‚‹ç¾è±¡ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-unknown" id="btnUnknown">ğŸ”„ è‹¦æ‰‹ / ã¾ã </button>
        <button class="btn btn-known" id="btnKnown">âœ… è¦šãˆãŸ</button>
    </div>

    <div class="completion-screen" id="completionScreen">
        <div class="completion-message">ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼<br>ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</div>
        <button class="btn btn-known" onclick="resetApp()">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
    </div>

    <script>
        // --- 1. Data ---
        const vocabulary = [
            { id: 1, word: "complete metamorphosis", phonetic: "[kÉ™mËˆpliËt ËŒmÉ›tÉ™ËˆmÉ”ËrfÉ™sÉªs]", translation: "å®Œå…¨å¤‰æ…‹", meaning: "æ˜†è™«ã®æˆé•·ã®éç¨‹ã§ã€åµâ†’å¹¼è™«â†’ã•ãªãã®3ã¤ã®æ®µéšã‚’çµŒã¦æˆè™«ã«å¤‰åŒ–ã™ã‚‹ç¾è±¡ã€‚" },
            { id: 2, word: "larvae", phonetic: "[ËˆlÉ‘ËrviË]", translation: "å¹¼è™«", meaning: "æˆè™«ã«ãªã‚‹å‰ã®å­ä¾›ã®æ˜†è™«ã€‚<br><span class='tag-ref'>å‚è€ƒ</span>å˜æ•°å½¢ã¯ larvaã€‚" },
            { id: 3, word: "caterpillar", phonetic: "[ËˆkÃ¦tÉ™rpÉªlÉ™r]", translation: "æ¯›è™«", meaning: "ä½“ãŒé•·ãã€ä½“è¡¨ãŒæ¯›ã§è¦†ã‚ã‚Œã¦ã„ã‚‹ãƒãƒ§ã‚¦ç›®ã®å¹¼è™«ã€‚" },
            { id: 4, word: "pupa", phonetic: "[ËˆpjuËpÉ™]", translation: "ã•ãªã", meaning: "<span class='tag-ref'>å‚è€ƒ</span>è¤‡æ•°å½¢ã¯ pupaeã€‚" },
            { id: 5, word: "cocoon", phonetic: "[kÉ™ËˆkuËn]", translation: "ç¹­ (ã¾ã‚†)", meaning: "å®Œå…¨å¤‰æ…‹ã‚’ã™ã‚‹æ˜†è™«ã®å¹¼è™«ãŒã•ãªãã«å¤‰ã‚ã‚‹éš›ã«ä½œã‚‹æ®»ã€‚" },
            { id: 6, word: "incomplete metamorphosis", phonetic: "[ËŒÉªnkÉ™mËˆpliËt ËŒmÉ›tÉ™ËˆmÉ”ËrfÉ™sÉªs]", translation: "ä¸å®Œå…¨å¤‰æ…‹", meaning: "å¹¼è™«ãŒã™ã§ã«æˆè™«ã¨åŒæ§˜ã®å½¢æ…‹ã‚’æœ‰ã—ã€ã•ãªãã®æ™‚ä»£ã‚’çµŒãªã„ã§æˆè™«ã«ãªã‚‹æˆé•·å½¢å¼ã€‚ãƒˆãƒ³ãƒœã€ãƒãƒƒã‚¿ãªã©ã«è¦‹ã‚‰ã‚Œã‚‹ã€‚" },
            { id: 7, word: "ecdysis", phonetic: "[ËˆÉ›kdÉ™sÉªs]", translation: "è„±çš®", meaning: "é ‘ä¸ˆãªè¡¨çš®ã‚’æŒã£ã¦ã„ã‚‹å‹•ç‰©ãŒæˆé•·ã®éç¨‹ã§å¤ã„è¡¨çš®ã‚’è„±ãç¾è±¡ã€‚" },
            { id: 8, word: "mimicry", phonetic: "[ËˆmÉªmÉªkri]", translation: "æ“¬æ…‹", meaning: "è‡ªåˆ†ã®èº«ã‚’å®ˆã£ãŸã‚Šã€ç‹©ã‚Šã‚’ã™ã‚‹ãŸã‚ã«ã€å‘¨å›²ã®ç’°å¢ƒã‚„ä»–ã®ç¨®ã®ç”Ÿç‰©ã¨éå¸¸ã«ã‚ˆãä¼¼ãŸå½¢æ…‹ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã€‚<br><span class='tag-ref'>å‹•</span>mimic: æ“¬æ…‹ã™ã‚‹" },
            { id: 9, word: "protective coloration", phonetic: "[prÉ™ËˆtÉ›ktÉªv ËŒkÊŒlÉ™ËˆreÉªÊƒÉ™n]", translation: "ä¿è­·è‰²", meaning: "å‘¨å›²ã®ç’°å¢ƒã«æº¶ã‘è¾¼ã‚“ã§ã€æ•µã«è¦‹ã¤ã‹ã‚Šã«ããã™ã‚‹ä½“ã®è‰²ã‚„æ¨¡æ§˜ã®ã“ã¨ã€‚" },
            { id: 10, word: "camouflage", phonetic: "[ËˆkÃ¦mÉ™flÉ‘ËÊ’]", translation: "å½è£…ã€æ“¬æ…‹", meaning: "ï¼ˆä¿è­·è‰²ã‚„å½¢ãªã©ã‚’é€šã˜ã¦ï¼‰æ•µã®ç›®ã‚’ã‚ã–ã‚€ããŸã‚ã«ã€å‘¨å›²ã®é¢¨æ™¯ã«ã¨ã‘ã“ã‚€ã“ã¨ã€‚" },
            { id: 11, word: "microhabitat", phonetic: "[ËˆmaÉªkroÊŠËŒhÃ¦bÉªtÃ¦t]", translation: "å¾®å°ç”Ÿæ¯åœ°", meaning: "å¾®ç”Ÿç‰©ã€æ˜†è™«ã®ã‚ˆã†ãªå°ã•ãªç”Ÿç‰©ãŒç”Ÿæ¯ã™ã‚‹ã®ã«é©ã—ãŸç’°å¢ƒã‚’æŒã¤å ´æ‰€ã®ã“ã¨ã€‚" },
            { id: 12, word: "antennae", phonetic: "[Ã¦nËˆtÉ›niË]", translation: "ï¼ˆæ˜†è™«ã®ï¼‰è§¦è§’", meaning: "ï¼ˆæ˜†è™«ã®ï¼‰é ­éƒ¨ã«ã¤ã„ã¦ã„ã‚‹ã€æ„Ÿè¦šã‚’ã¤ã‹ã•ã©ã‚‹å™¨å®˜ã€‚<br><span class='tag-ref'>å‚è€ƒ</span>å˜æ•°å½¢ã¯ antennaã€‚" },
            { id: 13, word: "abdomen", phonetic: "[ËˆÃ¦bdÉ™mÉ™n]", translation: "ï¼ˆæ˜†è™«ã®ï¼‰è…¹éƒ¨", meaning: "<span class='tag-ref'>é–¢é€£</span>head: é ­éƒ¨ / thorax: èƒ¸éƒ¨" },
            { id: 14, word: "pollinator", phonetic: "[ËˆpÉ‘ËlÉ™neÉªtÉ™r]", translation: "é€ç²‰è€…", meaning: "èŠ±ã®é›„ã—ã¹ã§ç”Ÿç”£ã•ã‚Œã‚‹èŠ±ç²‰ã‚’é›Œã—ã¹ã«ç§»ã™ç”Ÿç‰©ã®ã“ã¨ã§ã€ã»ã¨ã‚“ã©ã®æ˜†è™«ãŒãã®å½¹å‰²ã‚’æœãŸã™ã€‚" },
            { id: 15, word: "nectar", phonetic: "[ËˆnÉ›ktÉ™r]", translation: "ï¼ˆèŠ±ã®ï¼‰èœœ", meaning: "èŠ±ãŒåˆ†æ³Œã™ã‚‹ç”˜ã„æ¶²ä½“ã€‚æ˜†è™«ãªã©ã‚’å¼•ãå¯„ã›ã‚‹ãŸã‚ã®ã‚‚ã®ã€‚" },
            { id: 16, word: "infested", phonetic: "[ÉªnËˆfÉ›stÉªd]", translation: "ï¼ˆå®³è™«ãªã©ãŒï¼‰ç¾¤ãŒã£ãŸ", meaning: "å®³è™«ã‚„å¯„ç”Ÿè™«ãªã©ãŒå¤§é‡ç™ºç”Ÿã—ã¦ã€å ´æ‰€ã‚„ç‰©ã‚’è’ã‚‰ã—ã¦ã„ã‚‹çŠ¶æ…‹ã€‚" },
            { id: 17, word: "insecticide", phonetic: "[ÉªnËˆsÉ›ktÉªsaÉªd]", translation: "æ®ºè™«å‰¤", meaning: "æ˜†è™«ï¼ˆå®³è™«ï¼‰ã‚’é§†é™¤ã™ã‚‹ãŸã‚ã«ä½¿ã‚ã‚Œã‚‹è–¬å“ã€‚" },
            { id: 18, word: "exoskeleton", phonetic: "[ËŒÉ›ksoÊŠËˆskÉ›lÉ™tn]", translation: "å¤–éª¨æ ¼", meaning: "æ˜†è™«ã‚„ã‚«ãƒ‹ã®æ®»ã®ã‚ˆã†ã«ä½“ã®å¤–å´ã‚’å›²ã¿ã€ä½“ã‚’ä¿è­·ã—ãŸã‚Šã€æ”¯ãˆãŸã‚Šã™ã‚‹éª¨æ ¼ã®ã“ã¨ã€‚<br><span class='tag-ref'>é–¢é€£</span>endoskeleton: å†…éª¨æ ¼" },
            { id: 19, word: "pheromone", phonetic: "[ËˆfÉ›rÉ™moÊŠn]", translation: "ãƒ•ã‚§ãƒ­ãƒ¢ãƒ³", meaning: "å‹•ç‰©ã®ä½“å†…ã§ä½œã‚‰ã‚ŒãŸã‚ã¨ã«ä½“å¤–ã«æ”¾å‡ºã•ã‚Œã€åŒç¨®ã®ä»–ã®å€‹ä½“ã®è¡Œå‹•çš„ãƒ»ç”Ÿç†çš„åå¿œã‚’èª˜å°ã™ã‚‹ç‰©è³ªã€‚" },
            { id: 20, word: "sting", phonetic: "[stÉªÅ‹]", translation: "é‡ / åˆºã™", meaning: "<span class='tag-ref'>å</span>ï¼ˆæ˜†è™«ãªã©ã®ï¼‰é‡<br><span class='tag-ref'>å‹•</span>åˆºã™" },
            { id: 21, word: "bioluminescence", phonetic: "[ËŒbaÉªoÊŠluËmÉªËˆnÉ›sns]", translation: "ç”Ÿç‰©ç™ºå…‰", meaning: "ãƒ›ã‚¿ãƒ«ã®ã‚ˆã†ã«ã€ç”Ÿç‰©ãŒè‡ªã‚‰å…‰ã‚’å‡ºã™ç¾è±¡ã€‚" },
            { id: 22, word: "ephemeral insects", phonetic: "[ÉªËˆfÉ›mÉ™rÉ™l ËˆÉªnsÉ›kts]", translation: "å¯¿å‘½ãŒéå¸¸ã«çŸ­ã„æ˜†è™«", meaning: "ã‚«ã‚²ãƒ­ã‚¦ãªã©ã®ã‚ˆã†ã«ã€æˆè™«ã«ãªã£ã¦ã‹ã‚‰ã®å¯¿å‘½ãŒæ¥µç«¯ã«çŸ­ã„ï¼ˆ1æ—¥ãªã©ï¼‰æ˜†è™«ã®ã“ã¨ã€‚<br><span class='tag-ref'>å˜èª</span>ephemeral: ã¤ã‹ã®é–“ã®ã€çŸ­å‘½ãª" },
            { id: 23, word: "swarm", phonetic: "[swÉ”Ërm]", translation: "ç¾¤ã‚Œ", meaning: "ï¼ˆãƒãƒã‚„ã‚¢ãƒªã€ãƒãƒƒã‚¿ãªã©ãŒï¼‰ä¸€æ–¹å‘ã«ç§»å‹•ã™ã‚‹ãŸã‚ã«å½¢æˆã™ã‚‹å¤§ããªé›†å›£ã€‚" },
            { id: 24, word: "social insect", phonetic: "[ËˆsoÊŠÊƒÉ™l ËˆÉªnsÉ›kt]", translation: "ç¤¾ä¼šæ€§æ˜†è™«", meaning: "ãƒãƒã‚„ã‚¢ãƒªã®ã‚ˆã†ã«ã€åŒç¨®ã®å€‹ä½“ãŒé›†å›£ã‚’ãªã—ã€äº’ã„ã«å½¹å‰²ã‚’åˆ†æ‹…ã—ã¦ç”Ÿæ´»ã™ã‚‹æ˜†è™«ã®ã“ã¨ã€‚" },
            { id: 25, word: "hive", phonetic: "[haÉªv]", translation: "ãƒãƒã®å·£ã€ç¾¤ã‚Œ", meaning: "ãƒŸãƒ„ãƒãƒãªã©ãŒç”Ÿæ´»ã™ã‚‹å·£ç®±ã€‚ã¾ãŸã¯ã€1ã¤ã®å·£ã«ä½ã‚€ãƒãƒã®é›†å›£å…¨ä½“ã€‚" },
            { id: 26, word: "wasp", phonetic: "[wÉ‘Ësp]", translation: "ã‚¹ã‚ºãƒ¡ãƒãƒ", meaning: "ç‹©ã‚Šã‚’ã™ã‚‹ãƒãƒã®ä¸€ç¨®ã€‚é‡ã‚’æŒã¡ã€æ”»æ’ƒæ€§ãŒé«˜ã„ã‚‚ã®ãŒå¤šã„ã€‚ãƒŸãƒ„ãƒãƒ(bee)ã¨ã¯åŒºåˆ¥ã•ã‚Œã‚‹ã€‚" },
            { id: 27, word: "fruit fly", phonetic: "[fruËt flaÉª]", translation: "ãƒŸãƒã‚¨ / ã‚·ãƒ§ã‚¦ã‚¸ãƒ§ã‚¦ãƒã‚¨", meaning: "ç†Ÿã—ãŸæœå®Ÿã‚„æ¨¹æ¶²ã«é›†ã¾ã‚‹å°ã•ãªãƒã‚¨ã€‚" },
            { id: 28, word: "firefly", phonetic: "[ËˆfaÉªÉ™rflaÉª]", translation: "ãƒ›ã‚¿ãƒ«", meaning: "ãŠå°»ã®éƒ¨åˆ†ã‚’ç™ºå…‰ã•ã›ã¦ã€ä»²é–“ã¨ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¨ã‚‹æ˜†è™«ã€‚" },
            { id: 29, word: "cicada", phonetic: "[sÉªËˆkeÉªdÉ™]", translation: "ã‚»ãƒŸ", meaning: "å¹¼è™«ã¯é•·ã„é–“åœŸã®ä¸­ã§éã”ã—ã€æˆè™«ã«ãªã‚‹ã¨å¤ã«å¤§ããªå£°ã§é³´ãæ˜†è™«ã€‚" },
            { id: 30, word: "grasshopper", phonetic: "[ËˆÉ¡rÃ¦shÉ‘ËpÉ™r]", translation: "ãƒãƒƒã‚¿", meaning: "è‰åŸãªã©ã«ä½ã¿ã€å¾Œã‚è¶³ãŒç™ºé”ã—ã¦ã„ã¦é«˜ãã‚¸ãƒ£ãƒ³ãƒ—ã§ãã‚‹æ˜†è™«ã€‚" }
        ];

        // --- 2. State ---
        let deck = [];
        let currentCard = null;
        let voices = [];

        // DOM Elements
        const cardContainer = document.getElementById('cardContainer');
        const card = document.getElementById('card');
        const els = {
            number: document.getElementById('wordNumber'),
            main: document.getElementById('wordMain'),
            phonetic: document.getElementById('wordPhonetic'),
            translation: document.getElementById('wordTranslation'),
            meaning: document.getElementById('wordMeaning'),
            progress: document.getElementById('progressText'),
            audioBtn: document.getElementById('audioBtn')
        };
        const completionScreen = document.getElementById('completionScreen');

        // --- 3. Enhanced Speech Logic ---
        
        // Voice loading logic
        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
        }

        loadVoices();
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }

        function getBestVoice() {
            // Find English voices
            const enVoices = voices.filter(v => v.lang.startsWith('en'));
            if (enVoices.length === 0) return null;

            // Scoring system to find the "least dying" voice
            // Priority: Google US > Microsoft US > Apple Samantha > Any US > Any English
            let bestVoice = null;
            let highestScore = -1;

            enVoices.forEach(voice => {
                let score = 0;
                const name = voice.name.toLowerCase();
                const lang = voice.lang.toLowerCase();

                // Prefer US English
                if (lang === 'en-us') score += 10;
                else if (lang === 'en-gb') score += 5;

                // Prefer High Quality brands
                if (name.includes('google')) score += 20; // Google voices are usually online/high quality
                else if (name.includes('samantha')) score += 15; // MacOS/iOS standard
                else if (name.includes('siri')) score += 15; // iOS High Quality
                else if (name.includes('zira')) score += 10; // Windows decent standard
                
                // Avoid known low-quality robotic voices if possible
                if (name.includes('hazel') || name.includes('david')) score -= 5;

                if (score > highestScore) {
                    highestScore = score;
                    bestVoice = voice;
                }
            });

            return bestVoice;
        }

        function speak(text) {
            if (!window.speechSynthesis) return;
            
            window.speechSynthesis.cancel(); // Stop any previous sound

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            
            // Tuning for "Liveliness"
            utterance.rate = 1.0; // Normal speed (0.9 was too draggy)
            utterance.pitch = 1.05; // Slightly higher pitch for energy
            utterance.volume = 1.0;

            const selectedVoice = getBestVoice();
            if (selectedVoice) {
                utterance.voice = selectedVoice;
                // console.log("Using voice:", selectedVoice.name); // Debug
            }

            window.speechSynthesis.speak(utterance);
        }

        // --- 4. App Logic ---
        function initApp() {
            deck = [...vocabulary];
            completionScreen.style.display = 'none';
            loadNextCard();
        }

        function resetApp() {
            initApp();
        }

        function updateProgress() {
            const remaining = deck.length;
            if (currentCard) {
                els.progress.textContent = `æ®‹ã‚Š: ${remaining + 1} æš`;
            } else {
                els.progress.textContent = `æ®‹ã‚Š: 0 æš`;
            }
        }

        function loadNextCard() {
            card.classList.remove('flipped');

            setTimeout(() => {
                if (deck.length === 0) {
                    currentCard = null;
                    showCompletion();
                    return;
                }

                currentCard = deck.shift();
                
                els.number.textContent = String(currentCard.id).padStart(2, '0');
                els.main.textContent = currentCard.word;
                els.phonetic.textContent = currentCard.phonetic;
                els.translation.textContent = currentCard.translation;
                els.meaning.innerHTML = currentCard.meaning;

                updateProgress();
            }, 250);
        }

        function showCompletion() {
            els.progress.textContent = "æ®‹ã‚Š: 0 æš";
            completionScreen.style.display = 'flex';
        }

        // --- 5. Event Listeners ---

        cardContainer.addEventListener('click', () => {
            card.classList.toggle('flipped');
        });

        els.audioBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if(currentCard) {
                speak(currentCard.word);
            }
        });

        document.getElementById('btnUnknown').addEventListener('click', (e) => {
            e.stopPropagation();
            if (!currentCard) return;
            deck.push(currentCard);
            loadNextCard();
        });

        document.getElementById('btnKnown').addEventListener('click', (e) => {
            e.stopPropagation();
            if (!currentCard) return;
            loadNextCard();
        });

        document.addEventListener('DOMContentLoaded', initApp);

    </script>
</body>
</html>