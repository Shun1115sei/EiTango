<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biology 5: Physiology / Anatomy Flashcards</title>
    <style>
        :root {
            /* æ•™ç§‘æ›¸ã®ãƒ˜ãƒƒãƒ€ãƒ¼è‰²ã«åˆã‚ã›ãŸãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ */
            --primary-color: #e84118; 
            --secondary-color: #fcece8;
            --text-color: #333;
            --bg-color: #f5f6fa;
            --card-width: 320px;
            --card-height: 480px;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-color);
            overflow: hidden;
        }

        h1 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #555;
            text-align: center;
        }

        .progress-container {
            margin-bottom: 20px;
            text-align: center;
        }
        .progress-text {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Card Container */
        .card-container {
            width: var(--card-width);
            height: var(--card-height);
            perspective: 1000px;
            cursor: pointer;
            margin-bottom: 20px;
            position: relative;
        }

        /* The Card */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        /* Faces */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            background-color: white;
            border: 2px solid #fff;
        }

        /* Front */
        .card-front {
            z-index: 2;
        }

        .word-number {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 0.8rem;
            color: #999;
            font-weight: bold;
        }

        .word-main {
            font-size: 1.8rem; /* å°‘ã—é•·ã‚ã®å˜èªã‚‚ã‚ã‚‹ãŸã‚èª¿æ•´ */
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
            line-height: 1.2;
            word-wrap: break-word;
            width: 100%;
        }

        .word-phonetic {
            font-size: 1.1rem;
            color: #7f8c8d;
            font-family: "Lucida Sans Unicode", "Arial Unicode MS", sans-serif;
            margin-bottom: 30px;
        }

        .audio-btn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px rgba(232, 65, 24, 0.2);
        }

        .audio-btn:hover {
            transform: scale(1.1);
            background-color: #ffdcd6;
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .tap-hint {
            position: absolute;
            bottom: 20px;
            font-size: 0.8rem;
            color: #ccc;
        }

        /* Back */
        .card-back {
            transform: rotateY(180deg);
            background-color: #fafafa;
            border: 2px solid var(--secondary-color);
            justify-content: flex-start;
            padding-top: 40px;
        }

        .word-translation {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            width: 100%;
        }

        .word-meaning-container {
            width: 100%;
            overflow-y: auto;
            text-align: left;
            padding-right: 5px;
            flex-grow: 1;
        }

        .word-meaning-container::-webkit-scrollbar {
            width: 6px;
        }
        .word-meaning-container::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 3px;
        }

        .word-meaning {
            font-size: 1rem;
            line-height: 1.7;
            color: #555;
        }

        /* Tags for Tips */
        .tag-ref {
            display: inline-block;
            background: #eee;
            color: #666;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .tag-teacher {
            display: inline-block;
            background: #e1f5fe;
            color: #0277bd;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.1s, opacity 0.2s;
            width: 140px;
        }

        .btn:active {
            transform: translateY(2px);
        }

        .btn-unknown {
            background-color: #ffffff;
            color: #7f8c8d;
            border: 2px solid #bdc3c7;
        }

        .btn-known {
            background-color: var(--primary-color);
            color: white;
            border: 2px solid var(--primary-color);
        }

        /* Completion Screen */
        .completion-screen {
            display: none;
            text-align: center;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 100;
        }

        .completion-message {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        @media (max-width: 400px) {
            :root {
                --card-width: 90vw;
                --card-height: 60vh;
            }
            .btn {
                width: 40vw;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <h1>Biology 5: Physiology / Anatomy</h1>

    <div class="progress-container">
        <span class="progress-text" id="progressText">Loading...</span>
    </div>

    <div class="card-container" id="cardContainer">
        <div class="card" id="card">
            <!-- Front -->
            <div class="card-face card-front">
                <div class="word-number" id="wordNumber">01</div>
                <div class="word-main" id="wordMain">anatomy</div>
                <div class="word-phonetic" id="wordPhonetic">[É™nÇ½tÉ™mi]</div>
                <button class="audio-btn" id="audioBtn" title="ç™ºéŸ³ã‚’èã">ğŸ”Š</button>
                <div class="tap-hint">Tap card to flip</div>
            </div>
            <!-- Back -->
            <div class="card-face card-back">
                <div class="word-translation" id="wordTranslation">è§£å‰–å­¦</div>
                <div class="word-meaning-container">
                    <div class="word-meaning" id="wordMeaning">
                        <!-- Content injected via JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn btn-unknown" id="btnUnknown">ğŸ”„ è‹¦æ‰‹ / ã¾ã </button>
        <button class="btn btn-known" id="btnKnown">âœ… è¦šãˆãŸ</button>
    </div>

    <div class="completion-screen" id="completionScreen">
        <div class="completion-message">ğŸ‰ ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼<br>ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</div>
        <button class="btn btn-known" onclick="resetApp()">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
    </div>

    <script>
        // --- 1. Data (Biology 5: Physiology / Anatomy) ---
        // Teacher Notes added for items with "ãƒ¼"
        const vocabulary = [
            { id: 1, word: "anatomy", phonetic: "[É™ËˆnÃ¦tÉ™mi]", translation: "è§£å‰–å­¦", meaning: "<span class='tag-teacher'>è§£èª¬</span>ç”Ÿç‰©ã®ä½“ã®æ§‹é€ ã‚„ä»•çµ„ã¿ã€è‡“å™¨ã®é…ç½®ãªã©ã‚’ç ”ç©¶ã™ã‚‹å­¦å•ã®ã“ã¨ã€‚" },
            { id: 2, word: "circulatory", phonetic: "[ËŒsÉœËrkjÉ™lÉ™ËˆtÉ”Ëri]", translation: "è¡€æ¶²å¾ªç’°ã®", meaning: "<span class='tag-ref'>é–¢é€£</span>circulatory system: å¾ªç’°å™¨ç³»ï¼ˆå¿ƒè‡“ã€è¡€ç®¡ã€ãƒªãƒ³ãƒ‘ç®¡ã®ã‚ˆã†ãªè¡€æ¶²ã¨ãƒªãƒ³ãƒ‘ã®å¾ªç’°ã«é–¢ä¸ã™ã‚‹èº«ä½“å™¨å®˜ï¼‰ã€‚" },
            { id: 3, word: "blood vessel", phonetic: "[blÊŒd ËˆvÉ›sÉ™l]", translation: "è¡€ç®¡", meaning: "<span class='tag-ref'>é–¢é€£</span>artery: å‹•è„ˆ / vein: é™è„ˆ" },
            { id: 4, word: "red blood cell", phonetic: "[rÉ›d blÊŒd sÉ›l]", translation: "èµ¤è¡€çƒ", meaning: "è¡€æ¶²ä¸­ã‚’ç§»å‹•ã—ãªãŒã‚‰ã€ä½“ã®çµ„ç¹”ã«é…¸ç´ ã‚„äºŒé…¸åŒ–ç‚­ç´ ã‚’é‹ã¶è¡€æ¶²ç´°èƒã®ã“ã¨ã€‚ï¼ˆåˆ¥å: erythrocyteï¼‰<br><span class='tag-ref'>é–¢é€£</span>white blood cell: ç™½è¡€çƒï¼ˆå¤–éƒ¨ã‹ã‚‰ä¾µå…¥ã™ã‚‹ç´°èŒã‚„æ„ŸæŸ“ç—‡ã‹ã‚‰èº«ä½“ã‚’ä¿è­·ã™ã‚‹è¡€æ¶²ç´°èƒã®ã“ã¨ï¼‰" },
            { id: 5, word: "secrete", phonetic: "[sÉªËˆkriËt]", translation: "åˆ†æ³Œã™ã‚‹", meaning: "ï¼ˆä¸»ã«ä½“å†…ã§ä½œã‚‰ã‚ŒãŸã‚‚ã®ã‚’ï¼‰ç´°èƒã‚„å™¨å®˜ã‹ã‚‰ã˜ã‚ã£ã¨å¤–ã«å‡ºã™ã“ã¨ã€‚<br><span class='tag-ref'>é–¢é€£</span>excrete: ï¼ˆè€å»ƒç‰©ãªã©ã‚’ä½“ã®å¤–ã«ï¼‰æ’æ³„ã™ã‚‹" },
            { id: 6, word: "respiratory", phonetic: "[ËˆrÉ›spÉ™rÉ™tÉ”Ëri]", translation: "å‘¼å¸ã®ã€å‘¼å¸å™¨å®˜ã®", meaning: "<span class='tag-ref'>é–¢é€£</span>respiratory system: å‘¼å¸å™¨ç³»ï¼ˆæ°—é“ã€è‚ºã€æ°—ç®¡æ”¯ã€æ¨ªéš”è†œã®ã‚ˆã†ãªå‘¼å¸ã«é–¢ä¿‚ã™ã‚‹èº«ä½“ã®å™¨å®˜ï¼‰ã€‚" },
            { id: 7, word: "inhale", phonetic: "[ÉªnËˆheÉªl]", translation: "æ¯ã‚’å¸ã†", meaning: "<span class='tag-teacher'>è§£èª¬</span>ç©ºæ°—ã‚„ã€æ™‚ã«ã¯è–¬ãªã©ã‚’è‚ºã„ã£ã±ã„ã«å¸ã„è¾¼ã‚€å‹•ä½œã®ã“ã¨ã€‚" },
            { id: 8, word: "exhale", phonetic: "[É›ksËˆheÉªl]", translation: "æ¯ã‚’åã", meaning: "<span class='tag-teacher'>è§£èª¬</span>è‚ºã®ä¸­ã«ã‚ã‚‹ç©ºæ°—ã‚’å¤–ã«åãå‡ºã™å‹•ä½œã®ã“ã¨ã€‚" },
            { id: 9, word: "nostril", phonetic: "[ËˆnÉ‘ËstrÉ™l]", translation: "é¼»ã®ç©´", meaning: "<span class='tag-teacher'>è§£èª¬</span>ç©ºæ°—ã®å‡ºå…¥ã‚Šå£ã¨ãªã‚‹ã€é¼»ã®å­”ã®ã“ã¨ã€‚" },
            { id: 10, word: "airway", phonetic: "[ËˆÉ›rweÉª]", translation: "ï¼ˆé¼»ã‹ã‚‰è‚ºã¾ã§ã®ï¼‰æ°—é“", meaning: "<span class='tag-teacher'>è§£èª¬</span>å‘¼å¸ã‚’ã™ã‚‹ã¨ãã«ç©ºæ°—ãŒé€šã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã®ã“ã¨ã€‚" },
            { id: 11, word: "ingest", phonetic: "[ÉªnËˆdÊ’É›st]", translation: "æ‘‚å–ã™ã‚‹", meaning: "ï¼ˆé£Ÿå“ãƒ»è–¬ãªã©ï¼‰ã‚’å£ã‹ã‚‰ä½“å†…ã«å–ã‚Šå…¥ã‚Œã‚‹ã“ã¨ã€‚é£Ÿã¹ã‚‹ã€é£²ã‚€ã“ã¨ã®å°‘ã—å°‚é–€çš„ãªè¨€ã„æ–¹ã€‚" },
            { id: 12, word: "digest", phonetic: "[daÉªËˆdÊ’É›st]", translation: "ï½ã‚’æ¶ˆåŒ–ã™ã‚‹", meaning: "<span class='tag-ref'>å</span>digestion: æ¶ˆåŒ–<br><span class='tag-ref'>é–¢é€£</span>digestive system: æ¶ˆåŒ–å™¨ç³»ï¼ˆèƒƒã€è…¸ã®ã‚ˆã†ã«æ‘‚å–ã—ãŸé£Ÿç‰©ã®æ¶ˆåŒ–ã¨å¸åã‚’æ‹…å½“ã™ã‚‹èº«ä½“å™¨å®˜ï¼‰ã€‚" },
            { id: 13, word: "intestine", phonetic: "[ÉªnËˆtÉ›stÉªn]", translation: "è…¸", meaning: "<span class='tag-teacher'>è§£èª¬</span>èƒƒã®æ¬¡ã«ã‚ã‚‹é•·ã„ç®¡çŠ¶ã®å™¨å®˜ã€‚æ „é¤Šã‚’å¸åã—ãŸã‚Šä¾¿ã‚’ä½œã£ãŸã‚Šã™ã‚‹å ´æ‰€ã€‚" },
            { id: 14, word: "metabolism", phonetic: "[mÉ™ËˆtÃ¦bÉ™lÉªzÉ™m]", translation: "æ–°é™³ä»£è¬", meaning: "ç”Ÿç‰©å†…ã§èµ·ã“ã‚‹ç‰©è³ªã®ã™ã¹ã¦ã®åŒ–å­¦çš„å¤‰åŒ–ï¼ˆã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä½œã£ãŸã‚Šã€æ–°ã—ã„ç´°èƒã‚’ä½œã£ãŸã‚Šã™ã‚‹ã“ã¨ï¼‰ã€‚" },
            { id: 15, word: "skeleton", phonetic: "[ËˆskÉ›lÉ™tn]", translation: "éª¨æ ¼", meaning: "<span class='tag-ref'>é–¢é€£</span>skull: é ­è“‹éª¨" },
            { id: 16, word: "joint", phonetic: "[dÊ’É”Éªnt]", translation: "é–¢ç¯€", meaning: "<span class='tag-teacher'>è§£èª¬</span>éª¨ã¨éª¨ã®ã¤ãªãç›®ã€‚ã“ã“ãŒå‹•ãã“ã¨ã§ã€ã²ã˜ã‚„ã²ã–ã‚’æ›²ã’ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚" },
            { id: 17, word: "vertebra", phonetic: "[ËˆvÉœËrtÉ™brÉ™]", translation: "è„Šæ¤ï¼ˆèƒŒéª¨ã®ä¸€ã¤ï¼‰", meaning: "<span class='tag-ref'>å‚è€ƒ</span>è¤‡æ•°å½¢ã¯ vertebraeã€‚" },
            { id: 18, word: "marrow", phonetic: "[ËˆmÃ¦roÊŠ]", translation: "éª¨é«„", meaning: "éª¨ã®ä¸­ã«ã‚ã‚‹è¡€æ¶²ç´°èƒã‚’ä½œã‚Šå‡ºã™çµ„ç¹”ã€‚ï¼ˆbone marrow ã¨ã‚‚è¨€ã†ï¼‰ã€‚" },
            { id: 19, word: "apparatus", phonetic: "[ËŒÃ¦pÉ™ËˆrÃ¦tÉ™s]", translation: "ï¼ˆèº«ä½“ã®ï¼‰å™¨å®˜", meaning: "<span class='tag-ref'>é–¢é€£</span>the sensory apparatus: æ„Ÿè¦šå™¨å®˜" },
            { id: 20, word: "Rapid Eye Movement", phonetic: "[ËˆrÃ¦pÉªd aÉª ËˆmuËvmÉ™nt]", translation: "æ€¥é€Ÿçœ¼çƒé‹å‹• (REM)", meaning: "ãƒ¬ãƒ ç¡çœ æ™‚ã«çœ¼çƒãŒæ€¥é€Ÿã«é‹å‹•ã™ã‚‹ç¾è±¡ã€‚ã“ã®æ™‚ã€è„³æ³¢ã¯è¦šé†’çŠ¶æ…‹ã«ä¼¼ã¦ã„ã¦å¤¢ã‚’è¦‹ã‚‹ã€‚<br><span class='tag-ref'>é–¢é€£</span>Non-Rapid Eye Movement (NREM): éæ€¥é€Ÿçœ¼çƒé‹å‹•" },
            { id: 21, word: "tissue", phonetic: "[ËˆtÉªÊƒuË]", translation: "çµ„ç¹”", meaning: "é¡ä¼¼ã—ãŸå½¢æ…‹ã‚„æ©Ÿèƒ½ã‚’æŒã¤ç´°èƒã®é›†ã¾ã‚Šï¼ˆç­‹è‚‰çµ„ç¹”ã€ç¥çµŒçµ„ç¹”ãªã©ï¼‰ã€‚" },
            { id: 22, word: "cell wall", phonetic: "[sÉ›l wÉ”Ël]", translation: "ç´°èƒå£", meaning: "<span class='tag-teacher'>è§£èª¬</span>æ¤ç‰©ã‚„èŒé¡ã®ç´°èƒã®å‘¨ã‚Šã«ã‚ã‚‹ã€ç¡¬ãã¦ä¸ˆå¤«ãªå£ã€‚å‹•ç‰©ç´°èƒã«ã¯ãªã„ã€‚" },
            { id: 23, word: "membrane", phonetic: "[ËˆmÉ›mbreÉªn]", translation: "ï¼ˆäººä½“ã®çš®è†šãƒ»çµ„ç¹”ã®ï¼‰è†œ", meaning: "<span class='tag-teacher'>è§£èª¬</span>ç´°èƒã‚„çµ„ç¹”ã‚’åŒ…ã‚“ã§ã„ã‚‹è–„ã„çš®ã®ã“ã¨ã€‚" },
            { id: 24, word: "nerve", phonetic: "[nÉœËrv]", translation: "ç¥çµŒ", meaning: "è„³ã€è„Šé«„ã‹ã‚‰èº«ä½“å„éƒ¨ã¸ä¿¡å·ã‚’ä¼ãˆã€ã¾ãŸèº«ä½“å„éƒ¨ã‹ã‚‰ã®åˆºæ¿€ã‚’è„³ã€è„Šé«„ã¸ä¼ãˆã‚‹å™¨å®˜ã€‚" },
            { id: 25, word: "hypothalamus", phonetic: "[ËŒhaÉªpoÊŠËˆÎ¸Ã¦lÉ™mÉ™s]", translation: "è¦–åºŠä¸‹éƒ¨", meaning: "ä½“æ¸©èª¿ç¯€ã€ç‰©è³ªä»£è¬ã®èª¿æ•´ã€ç¡çœ ãªã©ç”Ÿå‘½ç¶­æŒã«é–¢ã‚ã‚‹è„³ã®éƒ¨åˆ†ã€‚" },
            { id: 26, word: "cortex", phonetic: "[ËˆkÉ”ËrtÉ›ks]", translation: "çš®è³ª", meaning: "å¤§è„³ã€è…è‡“ãªã©ã®å®Ÿè³ªè‡“å™¨ã®å¤–å±¤ã‚’ãªã™éƒ¨åˆ†ã€‚å†…éƒ¨ã¨å¤–å±¤ã¨ã§ã¯æ©Ÿèƒ½ãŒç•°ãªã‚‹ã“ã¨ãŒå¤šã„ã€‚<br><span class='tag-ref'>é–¢é€£</span>cerebrum cortex: å¤§è„³çš®è³ª" },
            { id: 27, word: "cuticle", phonetic: "[ËˆkjuËtÉªkÉ™l]", translation: "ã‚¯ãƒã‚¯ãƒ©ã€è§’çš®", meaning: "ç”Ÿç‰©ã®ç´°èƒã§æœ€ã‚‚å¤–å´ã®éƒ¨åˆ†ã‚’è¦†ã£ã¦ã„ã‚‹å›ºã„è†œçŠ¶ã®æ§‹é€ ã€‚" },
            { id: 28, word: "limb", phonetic: "[lÉªm]", translation: "å››è‚¢ã€æ‰‹è¶³", meaning: "<span class='tag-teacher'>è§£èª¬</span>äººé–“ã§ã„ã†è…•(arm)ã‚„è„š(leg)ã®ã“ã¨ã€‚æœ¨ã®ã€Œæã€ã¨ã„ã†æ„å‘³ã‚‚ã‚ã‚‹ã€‚" },
            { id: 29, word: "vocal cord", phonetic: "[ËˆvoÊŠkÉ™l kÉ”Ërd]", translation: "å£°å¸¯", meaning: "<span class='tag-teacher'>è§£èª¬</span>ã®ã©ã«ã‚ã‚‹ãƒ’ãƒ€ã€‚ç©ºæ°—ãŒé€šã‚‹ã¨ãã«éœ‡ãˆã¦å£°ã‚’å‡ºã™ã€æ¥½å™¨ã®å¼¦ã®ã‚ˆã†ãªå ´æ‰€ã€‚" },
            { id: 30, word: "inner ear", phonetic: "[ËˆÉªnÉ™r ÉªÉ™r]", translation: "å†…è€³", meaning: "å¹³è¡¡æ„Ÿè¦šã‚’å¸ã‚‹ä¸‰åŠè¦ç®¡ã¨ã€è´è¦šã‚’æ‹…å½“ã™ã‚‹è¸ç‰›ï¼ˆã‹ãã‚…ã†ï¼‰ã§æ§‹æˆã•ã‚ŒãŸã€è€³ã®æœ€ã‚‚å†…å´ã«ã‚ã‚‹éƒ¨åˆ†ã€‚<br>ï¼ˆå›³è§£ã‚ã‚Š: è€³ã®å¥¥ã®ã‚«ã‚¿ãƒ„ãƒ ãƒªã®ã‚ˆã†ãªéƒ¨åˆ†ï¼‰" }
        ];

        // --- 2. State & DOM ---
        let deck = [];
        let currentCard = null;
        let voices = [];

        const cardContainer = document.getElementById('cardContainer');
        const card = document.getElementById('card');
        const els = {
            number: document.getElementById('wordNumber'),
            main: document.getElementById('wordMain'),
            phonetic: document.getElementById('wordPhonetic'),
            translation: document.getElementById('wordTranslation'),
            meaning: document.getElementById('wordMeaning'),
            progress: document.getElementById('progressText'),
            audioBtn: document.getElementById('audioBtn')
        };
        const completionScreen = document.getElementById('completionScreen');

        // --- 3. Speech Logic (High Quality Preferred) ---
        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
        }
        loadVoices();
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }

        function getBestVoice() {
            const enVoices = voices.filter(v => v.lang.startsWith('en'));
            if (enVoices.length === 0) return null;

            let bestVoice = null;
            let highestScore = -1;

            enVoices.forEach(voice => {
                let score = 0;
                const name = voice.name.toLowerCase();
                const lang = voice.lang.toLowerCase();

                // Priority Logic
                if (lang === 'en-us') score += 10;
                else if (lang === 'en-gb') score += 5;

                if (name.includes('google')) score += 20; 
                else if (name.includes('samantha')) score += 15;
                else if (name.includes('siri')) score += 15;
                else if (name.includes('premium') || name.includes('enhanced')) score += 10;
                
                if (name.includes('hazel') || name.includes('david') || name.includes('zira')) score -= 5;

                if (score > highestScore) {
                    highestScore = score;
                    bestVoice = voice;
                }
            });
            return bestVoice;
        }

        function speak(text) {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 1.0;  // Normal speed for clarity
            utterance.pitch = 1.05; // Slightly higher pitch for energy
            
            const selectedVoice = getBestVoice();
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            window.speechSynthesis.speak(utterance);
        }

        // --- 4. App Logic ---
        function initApp() {
            deck = [...vocabulary];
            completionScreen.style.display = 'none';
            loadNextCard();
        }

        function resetApp() {
            initApp();
        }

        function updateProgress() {
            const remaining = deck.length;
            if (currentCard) {
                els.progress.textContent = `æ®‹ã‚Š: ${remaining + 1} æš`;
            } else {
                els.progress.textContent = `æ®‹ã‚Š: 0 æš`;
            }
        }

        function loadNextCard() {
            card.classList.remove('flipped');
            
            setTimeout(() => {
                if (deck.length === 0) {
                    currentCard = null;
                    showCompletion();
                    return;
                }

                currentCard = deck.shift();
                
                els.number.textContent = String(currentCard.id).padStart(2, '0');
                els.main.textContent = currentCard.word;
                els.phonetic.textContent = currentCard.phonetic;
                els.translation.textContent = currentCard.translation;
                els.meaning.innerHTML = currentCard.meaning;

                updateProgress();
            }, 250);
        }

        function showCompletion() {
            els.progress.textContent = "æ®‹ã‚Š: 0 æš";
            completionScreen.style.display = 'flex';
        }

        // --- 5. Event Listeners ---
        cardContainer.addEventListener('click', () => {
            card.classList.toggle('flipped');
        });

        els.audioBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if(currentCard) speak(currentCard.word);
        });

        document.getElementById('btnUnknown').addEventListener('click', (e) => {
            e.stopPropagation();
            if (!currentCard) return;
            deck.push(currentCard);
            loadNextCard();
        });

        document.getElementById('btnKnown').addEventListener('click', (e) => {
            e.stopPropagation();
            if (!currentCard) return;
            loadNextCard();
        });

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>